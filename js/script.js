function signin(){document.getElementById("main").style.display="none",document.getElementById("signin-area").style.display="inline",document.getElementById("signup-area").style.display="none",document.getElementById("error").style.display="inline"}function signup(){document.getElementById("main").style.display="none",document.getElementById("signin-area").style.display="none",document.getElementById("signup-area").style.display="inline",document.getElementById("error").style.display="inline"}function login(e,t){user.auth(e,t,({err:e})=>{e?document.getElementById("error").innerHTML='<p style="color:red;text-align:center">'+e+"</p>":(document.getElementById("username").value="",document.getElementById("password").value="",document.getElementById("confirmpassword").value="",document.getElementById("username-signin").value="",document.getElementById("password-signin").value="",document.getElementById("error").innerHTML="")})}function switchTheme(){"0"===localStorage.getItem("preference")?(document.body.classList.add("dark-mode"),localStorage.setItem("preference","1")):(document.body.classList.remove("dark-mode"),localStorage.setItem("preference","0"))}function signout(){document.getElementById("chat").style.display="none",document.getElementById("sign-out-button").style.display="none",document.getElementById("main").style.display="inline",user.leave()}async function sendMessage(){let e=user.get("all").set({what:document.getElementById("chat-message-input").value});db.get("chat").get((new Date).toISOString()).put(e)}db.on("auth",async e=>{document.getElementById("main").style.display="none",document.getElementById("signin-area").style.display="none",document.getElementById("signup-area").style.display="none",document.getElementById("chat").style.display="inline",document.getElementById("sign-out-button").style.display="inline",document.getElementById("error").style.display="none"}),document.getElementById("sign-up").onsubmit=function(e){e.preventDefault(),""===document.getElementById("username").value||""===document.getElementById("password").value||""===document.getElementById("confirmpassword").value?document.getElementById("error").innerHTML='<p style="color:red">Username or password cannot be empty</p>':document.getElementById("password").value!==document.getElementById("confirmpassword").value?document.getElementById("error").innerHTML='<p style="color:red">Passwords do not match</p>':user.create(document.getElementById("username").value,document.getElementById("password").value,({err:e})=>{e?document.getElementById("error").innerHTML='<p style="color:red;text-align:center">'+e+"</p>":login(document.getElementById("username").value,document.getElementById("password").value)})},document.getElementById("sign-in").onsubmit=function(e){e.preventDefault(),""===document.getElementById("username-signin").value||""===document.getElementById("password-signin").value?document.getElementById("error").innerHTML='<p style="color:red;text-align:center">Username or password cannot be empty</p>':login(document.getElementById("username-signin").value,document.getElementById("password-signin").value)},document.getElementById("chat-message-input").addEventListener("onkeydown",function(e){13===e.keyCode&&(e.preventDefault(),document.getElementById("send-message-button").click())}),document.getElementById("chat-input").onsubmit=function(e){e.preventDefault(),""!==document.getElementById("chat-message-input").value&&(sendMessage(),document.getElementById("chat-message-input").value="")},window.onload=function(){null===localStorage.getItem("preference")&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?localStorage.setItem("preference","1"):localStorage.setItem("preference","0")),"1"===localStorage.getItem("preference")&&document.body.classList.add("dark-mode")};var messages=[],match={".":{">":new Date(+new Date-108e5).toISOString()},"-":1};db.get("chat").map(match).once(async(e,t)=>{if(e){let t={who:await db.user(e).get("alias"),what:e.what,when:GUN.state.is(e,"what")};if(t.what){messages=[...messages.slice(-100),t].sort((e,t)=>e.when-t.when);let e=document.createElement("p");e.innerHTML=t.what+" - "+t.who+" @"+new Date(t.when).toLocaleTimeString(),document.getElementById("chat-container").insertBefore(e,document.getElementById("chat-container").children[messages.indexOf(t)+1])}}});
